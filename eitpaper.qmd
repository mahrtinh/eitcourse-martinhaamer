---
title: "Public Transport & daily commute"
author: "Martin Haamer"
format: html
editor: visual
bibliography: references.bib
---

# Introduction {#sec-intro}

*To do:* *Overview of research goals*

# Literature Review

# Data and Methodology {#sec-methods}

### Data

Daily commute patterns in Estonia

```{r}
#| label: setup-libraries and load data
#| echo: false
#| message: false
#| warning: false
#| output: false

# Load required libraries
library(sf)          # For reading spatial data
library(leaflet)     # For interactive maps
library(dplyr)       # For data manipulation
library(htmlwidgets) # For saving interactive widgets
library(RColorBrewer) # For color palettes

# Read the GPKG file
commute_data <- st_read("data/commute_data.gpkg")

# Check the coordinate reference system
st_crs(commute_data)

# Transform to WGS84 for web mapping
commute_data_4326 <- st_transform(commute_data, crs = 4326)
```

```{r}
#| label: explore-commute-data
#| echo: true

# Check the data structure
glimpse(commute_data_4326)

# Summary statistics
summary(commute_data_4326$count)

# Check unique values
cat("Number of commute routes:", nrow(commute_data_4326), "\n")
cat("Total commute count:", sum(commute_data_4326$count), "\n")
```


```{r}
#| label: interactive-commute-map
#| echo: false
#| fig-cap: "Interactive map of commute routes"

# Create color palette based on commute count
pal <- colorNumeric(
  palette = "viridis",
  domain = commute_data_4326$count
)

# Create the interactive map
commute_map <- leaflet(commute_data_4326) %>%
  # Add base map
  addTiles() %>%
  
  # Add commute routes as lines
  addPolylines(
    color = ~pal(count),
    weight = ~scales::rescale(count, to = c(1, 5)), # Line thickness based on count
    opacity = 0.8,
    popup = ~paste(
      "<strong>Commute Route</strong><br/>",
      "From:", start_kkood, "<br/>",
      "To:", end_kkood, "<br/>",
      "Purpose ID:", purposeid, "<br/>",
      "Count:", count, " trips"
    ),
    highlightOptions = highlightOptions(
      weight = 6,
      color = "#666",
      opacity = 1,
      bringToFront = TRUE
    )
  ) %>%
  
  # Add legend
  addLegend(
    pal = pal,
    values = ~count,
    opacity = 0.8,
    title = "Trip Count",
    position = "bottomright"
  ) %>%
  
  # Set view to Estonia (adjust coordinates if needed)
  setView(lng = 25.0, lat = 58.5, zoom = 8)

# Display the map
commute_map
```

The overview of the workflow is illustrated in @fig-mindmap.

![Figure 1. Mindmap](images/clipboard-1271000031.png){#fig-mindmap}

<https://excalidraw.com/#json=LJu4JBwU35Qrxl-_oKJzp,zz1TjPKuGm65Dqppz8BASw>

#Results {#sec-results}

# Discussion {#sec-discussion}

# Conclusion

This document demonstrates various Quarto features including headings, formatted text, equations, code chunks, and error handling.

# References
