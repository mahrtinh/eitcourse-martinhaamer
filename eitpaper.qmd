---
title: "Do public transport (PT) services align with daily commuting patterns?"
author: "Martin Haamer"
format: html
editor: visual
bibliography: references.bib
---

# Introduction {#sec-intro}

This paper provides a short insight into daily commuting data of Estonia and attempts to relate it to public transport data in GTFS data.

The main research question is: Do the current public transport services in Estonia match the daily commuting patterns?

# Literature Review

Car traffic is bad for the environment and we want more people to travel using public transport [@poorthuis2023]

# Data and Methodology {#sec-methods}

An overview of the workflow is illustrated in @fig-mindmap.

![Workflow](images/clipboard-1271000031.png){#fig-mindmap}

<https://excalidraw.com/#json=LJu4JBwU35Qrxl-_oKJzp,zz1TjPKuGm65Dqppz8BASw>

### Data

Daily commute patterns in Estonia

```{r}
#| label: setup-libraries and load data
#| echo: false
#| message: false
#| warning: false
#| output: false

# Load required libraries
library(sf)          # For reading spatial data
library(leaflet)     # For interactive maps
library(dplyr)       # For data manipulation
library(htmlwidgets) # For saving interactive widgets
library(RColorBrewer) # For color palettes

# Read the GPKG file
commute_data <- st_read("data/commute_data.gpkg")

# Check the coordinate reference system
st_crs(commute_data)

# Transform to WGS84 for web mapping
commute_data_4326 <- st_transform(commute_data, crs = 4326)
```

```{r}
#| label: explore-commute-data
#| echo: true

# Check the data structure
glimpse(commute_data_4326)

# Summary statistics
summary(commute_data_4326$count)

# Check unique values
cat("Number of commute routes:", nrow(commute_data_4326), "\n")
cat("Total commute count:", sum(commute_data_4326$count), "\n")
```

# Results {#sec-results}

```{r}
#| label: interactive-commute-map
#| echo: false
#| fig-cap: "Figure 2. Interactive map of commute routes"

# Create the interactive map
commute_map <- leaflet(commute_data_4326) %>%
  # Add grayscale base map
  addProviderTiles(providers$CartoDB.Positron) %>%
  
  # Add commute routes as lines
  addPolylines(
    color = "#2c3e50",  # Single dark blue-gray color for all lines
    weight = ~scales::rescale(count, to = c(1, 8)), # Line thickness based on count (wider range)
    opacity = ~scales::rescale(count, to = c(0.3, 1.0)), # Opacity based on count
    popup = ~paste(
      "<strong>Commute Route</strong><br/>",
      "From:", start_kkood, "<br/>",
      "To:", end_kkood, "<br/>",
      "Count:", count, " trips"
    ),
    highlightOptions = highlightOptions(
      weight = 10,
      color = "#e74c3c", # Red highlight color
      opacity = 1,
      bringToFront = TRUE
    )
  ) %>%
  
  # Set view to Estonia (adjust coordinates if needed)
  setView(lng = 25.0, lat = 58.5, zoom = 8)

# Display the map
commute_map
```

# Discussion {#sec-discussion}

# Conclusion

# References
